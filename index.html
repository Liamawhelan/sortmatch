<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Tournaments with SortMatch.ca</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
        <link href='https://fonts.googleapis.com/css?family=Lobster|Cabin' rel='stylesheet' type='text/css'>
        <link href='style.css' rel='stylesheet' type='text/css'>
    </head>
    <body>
        <div class="container theme-showcase" role="main" id="vue-app">
            <div id="detail" v-if="name" v-cloak>
                <p v-if="banner"><img v-on:click="bannerChange" src="{{ banner }}" /></p>
                <div class="row">
                    <div class="col-sm-4" v-bind:class="{ 'col-sm-offset-4': !matches.length, 'sliding-transition': matches.length }">
                        <h2>Competitors</h2>
                        <p v-if="competitors.length < 2">Start by adding at least 2 competitors</p>
                        <table v-bind:class="{ 'table': competitors.length, 'unstyled': !competitors.length }">
                            <thead v-if="competitors.length">
                                <tr>
                                    <th>Name</th>
                                    <th>Matches</th>
                                    <th>Rating</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="competitor in competitors | orderBy 'ranking.getRating()' -1">
                                    <td v-highlight="competitor.name">{{ competitor.name }}</td>
                                    <td v-highlight="competitor.matches.length">{{ competitor | matchesCompleted }}</td>
                                    <td v-highlight="competitor.ranking.getRating()" title="{{ competitor.ranking.getRating() / 100 | round '2' }}">
                                        <div class="progress">
                                            <div class="progress-bar" v-bind:class="{ 'progress-bar-striped': competitor.matched, 'progress-bar-info': competitor.matched, 'active': competitor.matched }" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: {{ Math.min(100, competitor.ranking.getRating() / 20) }}%;">
                                                {{ competitor.ranking.getRating() / 100 | round '0' }}
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="3">
                                        <button id="competitor-add" class="btn btn-success" v-bind:class="{ 'btn-sm': matches.length }" v-on:click="competitorAdd"><span class="glyphicon glyphicon-plus"></span> Add competitor</button>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <div class="col-sm-8" v-if="matches.length" transition="delayedfade">
                        <h2 v-if="matches.length">Pending Matches</h2>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Matched</th>
                                    <th>Favored</th>
                                    <th>Challenger</th>
                                    <th>Finished</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="match in matches | finished false | favoredOrder">
                                    <td v-highlight="match.start">{{ match.start.toLocaleTimeString() }}</td>
                                    <td>{{ match.favored.name }}</td>
                                    <td>{{ match.unfavored.name }}</td>
                                    <td>
                                        <div class="dropdown">
                                            <button class="btn btn-success btn-xs dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">Record result <span class="caret"></span></button>
                                            <ul class="dropdown-menu dropdown-menu-right">
                                                <li><a href="#" v-on:click="matchResolve(match, RESULT_FAVORED)">Win for {{ match.favored.name }}</a></li>
                                                <li><a href="#" v-on:click="matchResolve(match, RESULT_TIE)">Tie</a></li>
                                                <li><a href="#" v-on:click="matchResolve(match, RESULT_UNFAVORED)">Win for {{ match.unfavored.name }}</a></li>
                                                <li role="separator" class="divider"></li>
                                                <li><a href="#" v-on:click="matchResolve(match, RESULT_ABANDONED)">Match did not take place</a></li>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr class="active">
                                    <td colspan="4">
                                        <div class="btn-group">
                                            <label class="btn btn-sm btn-default" v-bind:class="{ 'active': paused }">
                                                <input type="radio" v-bind:value="true" v-model="paused">
                                                <span class="glyphicon glyphicon-pause"></span> Pause matchmaking
                                            </label>
                                            <label class="btn btn-sm btn-default" v-bind:class="{ 'active': !paused }">
                                                <input type="radio" v-bind:value="false" v-model="paused">
                                                <span v-if="paused">
                                                    <span class="glyphicon glyphicon-play"></span> Continue matchmaking
                                                </span>
                                                <span v-else>
                                                    <span class="glyphicon glyphicon-play"></span> Next matchmaking: <span id="countdown">{{ countdown }}s</span>
                                                </span>
                                            </label>
                                        </div>
                                        <span class="dropdown">
                                            <button class="btn btn-default btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"><span class="glyphicon glyphicon-cog"></span> <span class="caret"></span></button>
                                            <ul class="dropdown-menu dropdown-menu-right">
                                                <li><a href="#" v-on:click="tournamentExport">Export tournament</a>
                                                <li><a href="#" v-on:click="bannerChange">Change banner</a>
                                                <li role="separator" class="divider"></li>
                                                <li><a href="#" v-on:click="tournamentDelete">Delete tournament</a>
                                            </ul>
                                        </span>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                        <footer class="small">
                            <p v-if="competitors.length && matches.length && matches.length < competitors.length * 5">Keep going until all competitors have completed at least 10 matches.</p>
                            <p v-if="competitors.length && matches.length >= competitors.length * 5 && !paused">When you're satisfied enough matches have taken place, pause matchmaking and finish the remaining matches.</p>
                            <p v-if="competitors.length && matches.length >= competitors.length * 5 && paused">Finish the remaining matches and declare the victor. Optionally, hold one final match between the top two competitors.</p>
                        </footer>
                        <h2>Completed Matches</h2>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Matched</th>
                                    <th>Favored</th>
                                    <th>Challenger</th>
                                    <th>Finished</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="match in matches | finished true | orderBy 'finished' -1">
                                    <td v-highlight="match.start">{{ match.start.toLocaleTimeString() }}</td>
                                    <td v-bind:class="{ 'danger': match.result === RESULT_UNFAVORED, 'success': match.result === RESULT_FAVORED, 'warning': match.result === RESULT_TIE, 'info': match.result === RESULT_ABANDONED }">{{ match.favored.name }}</td>
                                    <td v-bind:class="{ 'danger': match.result === RESULT_FAVORED, 'success': match.result === RESULT_UNFAVORED, 'warning': match.result === RESULT_TIE, 'info': match.result === RESULT_ABANDONED }">{{ match.unfavored.name }}</td>
                                    <td v-highlight="match.finished" v-on:click="matchRevert(match)">{{ match.finished.toLocaleTimeString() }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div id="index" v-else class="unstyled" v-cloak>
                <p><img id="logo" src="trophy-icon.png" /></p>
                <h1>Tournaments with SortMatch.ca</h1>
                <p>
                    <span v-for="tournamentName in tournamentNames">
                        <a href="?{{ tournamentName }}" class="btn" v-bind:class="{ 'btn-primary': tournamentName == 'Example Tournament', 'btn-info': tournamentName != 'Example Tournament' }"><span class="glyphicon glyphicon-play"></span> {{ tournamentName }}</a>
                    </span>
                    <button class="btn btn-success" v-on:click="tournamentAdd"><span class="glyphicon glyphicon-plus"></span> Start a new tournament</button>
                </p>
                <footer class="small">
                    <p>This tool is provided to help you run tournaments (e.g. hockey, tennis, chess, <a href="http://www.spyparty.com/">SpyParty</a>).</p>
                    <p>The underlying tournament methodology is <a href="https://en.wikipedia.org/wiki/Glicko_rating_system">Gicko2</a>, a system similar to <a href="https://en.wikipedia.org/wiki/Elo_rating_system">Elo</a>.</p>
                    <p>A competitor's rating is adjusted by how surprising the result of a match is.</p>
                    <p>Tournaments are saved locally in your browser's cache and can be exported.</p>
                    <p>You can stream results and facilitate conversations using services like <a href="http://www.twitch.tv/">Twitch</a>.</p>
                    <p>Feedback? Send me an email at <a href="mailto:bradbeattie@gmail.com">bradbeattie@gmail.com</a>.</p>
                    <hr />
                    <p>Remember, tournaments are for comparing competitors two at a time and declaring a winner.<br/>If you need a tool for creating elections, try <a href="https://modernballots.com">ModernBallots.com</a> instead.</p>
                </footer>
                <h3>Import a downloaded tournament</h3>
                <input type="file" id="files" name="files[]" multiple class="btn btn-default btn-sm" />
            </div>
        </div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/1.0.10/vue.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <script src="jquery.color-2.1.2.min.js"></script>
        <script src="FileSaver.min.js"></script>
        <script src="glicko2.js"></script>
        <script src="tournament.js"></script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-6512994-8', 'auto');
            ga('send', 'pageview');
        </script>
    </body>
</html>
